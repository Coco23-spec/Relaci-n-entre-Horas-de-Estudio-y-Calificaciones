import React from 'react';
import { ScatterChart, Scatter, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine } from 'recharts';

const ScatterPlotEstudios = () => {
  // Datos de horas de estudio (X) y calificaciones (Y)
  const horasEstudio = [6.35, 9.59, 1.03, 8.67, 0.29, 5.35, 4.04, 5.24, 3.65, 1.91, 0.19, 5.18, 8.43, 3.73, 2.23, 0.81, 0.85, 2.21, 1, 2.65, 0.66, 0.66, 8.56, 1.62, 5.6, 7.73, 4.56, 1.53, 2, 4.33, 5.28, 3.49, 7.81, 7.51, 9.27, 0.29, 8.96, 3.93, 8.78, 6.91, 9.87, 7.59, 3.65, 5.01, 3.76, 3.65, 2.61, 4.96, 6.82, 2.77, 5.24, 1.17, 1.6, 0.47, 9.71, 0.04, 1.79, 6.13, 0.81, 8.82, 7.2, 9.66, 5.08, 3, 5.5, 9.31, 5.21, 2.67, 8.77, 3.72, 0.01, 2.48, 3.18, 8.59, 4.59, 4.45, 3.36, 8.81, 9.45, 9.92, 3.77, 9.66, 7.92, 6.76, 2.45, 2.16, 1.66, 9.23, 2.94, 4.53, 4.94, 7.78, 8.44, 1.39, 4.27, 8.43, 8.18, 1.02, 1.56, 3.04];
  
  const calificaciones = [36.1, 49.2, 11, 43.7, 9.2, 24.4, 24.4, 34.5, 19.2, 10.4, 3.1, 30.8, 41.4, 32.4, 22.1, 6.7, 13.1, 14.7, 6.7, 24.5, 1, 12.5, 44.9, 10.5, 40.4, 40.7, 20.8, 28, 16.6, 28.6, 33.1, 16.9, 45.8, 39.7, 57, 8.9, 54.1, 24.4, 48.5, 38.7, 51.2, 51.2, 22.7, 36.7, 25.5, 26.1, 9.2, 23.5, 44.1, 19.1, 33.8, 12, 8.7, 10.1, 47.8, 4.9, 16.7, 34.7, 8.1, 51.1, 46.2, 45, 33.2, 18.2, 37.2, 51.4, 31.7, 11.6, 42.9, 17.9, -5.3, 9.1, 24.3, 46.8, 32.5, 31.9, 24.9, 40.6, 55.6, 57.7, 29.8, 49.9, 41.3, 40.9, 16.4, 21.2, -1.2, 47.3, 29.6, 33.2, 35.3];

  // Combinar datos en formato para el gráfico
  const data = horasEstudio.map((horas, index) => ({
    x: horas,
    y: calificaciones[index]
  }));

  // Calcular estadísticas básicas
  const n = data.length;
  const meanX = horasEstudio.reduce((a, b) => a + b, 0) / n;
  const meanY = calificaciones.reduce((a, b) => a + b, 0) / n;
  
  // Calcular correlación
  const numerator = data.reduce((sum, point) => sum + (point.x - meanX) * (point.y - meanY), 0);
  const denomX = Math.sqrt(data.reduce((sum, point) => sum + Math.pow(point.x - meanX, 2), 0));
  const denomY = Math.sqrt(data.reduce((sum, point) => sum + Math.pow(point.y - meanY, 2), 0));
  const correlation = numerator / (denomX * denomY);

  // Tooltip personalizado
  const CustomTooltip = ({ active, payload }) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-white p-3 border border-gray-300 rounded shadow-lg">
          <p className="text-sm">
            <span className="font-semibold">Horas de estudio:</span> {payload[0].payload.x.toFixed(2)}
          </p>
          <p className="text-sm">
            <span className="font-semibold">Calificación:</span> {payload[0].payload.y.toFixed(1)}
          </p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full p-6 bg-gray-50">
      <div className="bg-white rounded-lg shadow-lg p-6">
        <h2 className="text-2xl font-bold text-center text-gray-800 mb-2">
          Relación entre Horas de Estudio y Calificaciones
        </h2>
        <p className="text-center text-gray-600 mb-6">
          Gráfica de dispersión mostrando la correlación entre variables
        </p>
        
        <div className="mb-4 p-4 bg-blue-50 rounded-lg">
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div>
              <span className="font-semibold text-blue-700">Observaciones:</span>
              <p className="text-gray-700">{n} puntos</p>
            </div>
            <div>
              <span className="font-semibold text-blue-700">Correlación:</span>
              <p className="text-gray-700">{correlation.toFixed(3)}</p>
            </div>
            <div>
              <span className="font-semibold text-blue-700">Media horas:</span>
              <p className="text-gray-700">{meanX.toFixed(2)}</p>
            </div>
            <div>
              <span className="font-semibold text-blue-700">Media calificación:</span>
              <p className="text-gray-700">{meanY.toFixed(1)}</p>
            </div>
          </div>
        </div>

        <div className="h-96">
          <ResponsiveContainer width="100%" height="100%">
            <ScatterChart margin={{ top: 20, right: 30, bottom: 60, left: 60 }}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
              <XAxis 
                type="number" 
                dataKey="x" 
                name="Horas de Estudio"
                domain={[0, 'dataMax']}
                label={{ 
                  value: 'Horas de Estudio', 
                  position: 'insideBottom', 
                  offset: -10,
                  style: { textAnchor: 'middle', fontSize: '14px', fontWeight: 'bold' }
                }}
              />
              <YAxis 
                type="number" 
                dataKey="y" 
                name="Calificación"
                domain={['dataMin - 5', 'dataMax + 5']}
                label={{ 
                  value: 'Calificación', 
                  angle: -90, 
                  position: 'insideLeft',
                  style: { textAnchor: 'middle', fontSize: '14px', fontWeight: 'bold' }
                }}
              />
              <Tooltip content={<CustomTooltip />} />
              
              {/* Líneas de referencia para las medias */}
              <ReferenceLine x={meanX} stroke="#ff6b6b" strokeDasharray="5 5" opacity={0.7} />
              <ReferenceLine y={meanY} stroke="#ff6b6b" strokeDasharray="5 5" opacity={0.7} />
              
              <Scatter 
                data={data} 
                fill="#4f46e5" 
                fillOpacity={0.7}
                stroke="#3730a3"
                strokeWidth={1}
                r={4}
              />
            </ScatterChart>
          </ResponsiveContainer>
        </div>

        <div className="mt-4 text-sm text-gray-600">
          <p className="mb-2">
            <span className="font-semibold">Interpretación:</span> 
            {correlation > 0.7 ? " Correlación positiva fuerte" : 
             correlation > 0.3 ? " Correlación positiva moderada" :
             correlation > 0.1 ? " Correlación positiva débil" :
             correlation > -0.1 ? " Sin correlación clara" :
             correlation > -0.3 ? " Correlación negativa débil" :
             correlation > -0.7 ? " Correlación negativa moderada" :
             " Correlación negativa fuerte"}
            {correlation > 0 ? 
              " - A mayor tiempo de estudio, tienden a ser mayores las calificaciones." :
              " - No hay una relación lineal clara entre las variables."}
          </p>
          <p className="text-xs">
            Las líneas punteadas rojas indican los valores promedio de cada variable.
          </p>
        </div>
      </div>
    </div>
  );
};

export default ScatterPlotEstudios;
